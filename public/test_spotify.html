<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscar canciones en Spotify</title>
</head>
<body>
  <h1>Buscar canciones</h1>
  <input type="text" id="searchInput" placeholder="Nombre de la canción">
  <button id="searchBtn">Buscar</button>
  <div id="trackInfo"></div>

  <script>
    // Obtener token de la URL
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    const accessToken = params.get("access_token");

    if (!accessToken) {
      document.getElementById("trackInfo").innerHTML = "<p>No se pudo obtener el token. Vuelve a iniciar sesión.</p>";
    }

    // Buscar canciones
    document.getElementById("searchBtn").addEventListener("click", () => {
      const query = document.getElementById("searchInput").value.trim();
      if (!query) return alert("Introduce el nombre de una canción.");

      fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=1`, {
        headers: { Authorization: "Bearer " + accessToken }
      })
      .then(res => {
        if (!res.ok) throw new Error("Token inválido o expirado");
        return res.json();
      })
      .then(data => {
        const track = data.tracks?.items[0];
        if (!track) {
          document.getElementById("trackInfo").innerHTML = "<p>No se encontró ninguna canción.</p>";
          return;
        }

        document.getElementById("trackInfo").innerHTML = `
          <h2>${track.name}</h2>
          <p>${track.artists[0].name}</p>
          <img src="${track.album.images[0].url}" width="150" alt="Portada del álbum">
          ${track.preview_url ? `<audio controls src="${track.preview_url}"></audio>` : "<p>No hay preview disponible.</p>"}
        `;
      })
      .catch(err => {
        console.error(err);
        document.getElementById("trackInfo").innerHTML = `<p>Error: ${err.message}</p>`;
      });
    });
  </script>
</body>
</html>
